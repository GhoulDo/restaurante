================================================================================
                    DOCUMENTACIÃ“N API - SISTEMA RESTAURANTE
================================================================================

DESARROLLO: http://localhost:8081/api
PRODUCCIÃ“N: https://restaurante-api.onrender.com/api

ğŸ”§ ENDPOINTS DE DEBUG:
GET / - InformaciÃ³n completa del servicio + endpoints disponibles
GET /health - Estado de salud detallado
GET /ping - Ping rÃ¡pido para verificaciÃ³n
GET /test-cors - Test de configuraciÃ³n CORS

ğŸ¤– KEEP-ALIVE AUTOMÃTICO: El servicio se mantiene activo automÃ¡ticamente
â° HORARIOS OPTIMIZADOS:
   - Ping cada 10 minutos (24/7)
   - Ping cada 5 minutos (8 AM - 10 PM)
   - Ping cada 3 minutos (horas pico: 12-2 PM y 7-9 PM)

HEADERS RECOMENDADOS:
Content-Type: application/json
Accept: application/json

ğŸ› ï¸ CORS CONFIGURADO CORRECTAMENTE:
- allowedOriginPatterns: * (permite todos los orÃ­genes)
- allowCredentials: false (compatible con origen "*")
- MÃ©todos permitidos: GET, POST, PUT, DELETE, OPTIONS, PATCH
- Headers permitidos: todos (*)

================================================================================
                            CONFIGURACIÃ“N PARA FRONTEND
================================================================================

// IMPORTANTE: Para evitar el error "NODE_ENV cannot be accessed on the client"
// Usar esta configuraciÃ³n en el frontend:

// âœ… CORRECTO - Para Next.js/React
const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 
  (typeof window !== 'undefined' && window.location.hostname === 'localhost' 
    ? 'http://localhost:8081/api' 
    : 'https://restaurante-api.onrender.com/api');

// âœ… CORRECTO - Para aplicaciones SPA
const API_BASE_URL = window.location.hostname === 'localhost' 
  ? 'http://localhost:8081/api'
  : 'https://restaurante-api.onrender.com/api';

// âœ… CORRECTO - ConfiguraciÃ³n manual
const API_BASE_URL = 'https://restaurante-api.onrender.com/api'; // Para producciÃ³n
// const API_BASE_URL = 'http://localhost:8081/api'; // Para desarrollo

const defaultHeaders = {
  'Content-Type': 'application/json',
  'Accept': 'application/json'
};

// FunciÃ³n helper mejorada con mejor manejo de errores
const apiRequest = async (endpoint, options = {}) => {
  try {
    console.log(`ğŸŒ API Request: ${API_BASE_URL}${endpoint}`);
    
    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
      ...options,
      headers: { ...defaultHeaders, ...options.headers }
    });
    
    console.log(`ğŸ“¡ Response Status: ${response.status}`);
    
    if (!response.ok) {
      const errorText = await response.text();
      console.error(`âŒ API Error: ${response.status} - ${errorText}`);
      throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`);
    }
    
    const result = response.status === 204 ? null : await response.json();
    console.log(`âœ… API Success:`, result);
    return result;
  } catch (error) {
    console.error('ğŸ’¥ API request failed:', error);
    throw error;
  }
};

// Test de conectividad
const testConnection = async () => {
  try {
    const response = await fetch(`${API_BASE_URL.replace('/api', '')}/health`);
    const data = await response.json();
    console.log('ğŸŸ¢ Backend conectado:', data);
    return true;
  } catch (error) {
    console.error('ğŸ”´ Backend no disponible:', error);
    return false;
  }
};

================================================================================
                        TROUBLESHOOTING - ERRORES COMUNES
================================================================================

âŒ ERROR: "Failed to fetch"
CAUSA: CORS o backend no disponible
SOLUCIÃ“N: 
1. Verificar que el backend estÃ© corriendo
2. Verificar la URL de la API
3. Test: curl https://tu-api.onrender.com/health

âŒ ERROR: "NODE_ENV cannot be accessed on the client"
CAUSA: process.env.NODE_ENV usado en frontend
SOLUCIÃ“N: Usar las configuraciones de arriba

âŒ ERROR: "404 Not Found"
CAUSA: Endpoint incorrecto
SOLUCIÃ“N: Verificar rutas disponibles en GET /

âŒ ERROR: "CORS policy"
CAUSA: ConfiguraciÃ³n CORS incorrecta
SOLUCIÃ“N: Backend ya configurado con CORS para todos los orÃ­genes

VERIFICACIONES BÃSICAS:
1. Backend activo: GET https://tu-api.onrender.com/health
2. CORS funcionando: GET https://tu-api.onrender.com/test-cors
3. Endpoints: GET https://tu-api.onrender.com/
4. API disponible: GET https://tu-api.onrender.com/api/empleados

================================================================================
                               CATEGORÃAS âœ…
================================================================================

BASE: /api/categorias

1. OBTENER TODAS LAS CATEGORÃAS âœ…
   GET /api/categorias
   
   Ejemplo JavaScript:
   const getCategorias = () => apiRequest('/categorias');

2. OBTENER CATEGORÃA POR ID âœ…
   GET /api/categorias/{id}
   
   Ejemplo JavaScript:
   const getCategoriaById = (id) => apiRequest(`/categorias/${id}`);

3. CREAR NUEVA CATEGORÃA âœ…
   POST /api/categorias
   
   Body:
   {
     "nombre": "Postres"
   }

4. ACTUALIZAR CATEGORÃA âœ…
   PUT /api/categorias/{id}

5. ELIMINAR CATEGORÃA âœ…
   DELETE /api/categorias/{id}

================================================================================
                               PRODUCTOS âœ…
================================================================================

BASE: /api/productos

1. OBTENER TODOS LOS PRODUCTOS âœ…
   GET /api/productos
   
   Ejemplo JavaScript:
   const getProductos = () => apiRequest('/productos');

2. OBTENER PRODUCTOS DISPONIBLES âœ…
   GET /api/productos/disponibles
   
   Ejemplo JavaScript:
   const getProductosDisponibles = () => apiRequest('/productos/disponibles');

3. OBTENER PRODUCTO POR ID âœ…
   GET /api/productos/{id}

4. OBTENER PRODUCTOS POR CATEGORÃA âœ…
   GET /api/productos/categoria/{categoriaId}
   
   Ejemplo JavaScript:
   const getProductosByCategoria = (categoriaId) => 
     apiRequest(`/productos/categoria/${categoriaId}`);

5. ğŸ†• BUSCAR PRODUCTOS POR NOMBRE âœ…
   GET /api/productos/buscar?nombre={nombre}
   
   Ejemplo JavaScript:
   const buscarProductos = (nombre) => 
     apiRequest(`/productos/buscar?nombre=${encodeURIComponent(nombre)}`);

6. CREAR NUEVO PRODUCTO âœ…
   POST /api/productos

7. ACTUALIZAR PRODUCTO âœ…
   PUT /api/productos/{id}

8. ELIMINAR PRODUCTO âœ…
   DELETE /api/productos/{id}

================================================================================
                                 MESAS âœ…
================================================================================

BASE: /api/mesas

1. OBTENER TODAS LAS MESAS âœ…
   GET /api/mesas

2. OBTENER MESA POR ID âœ…
   GET /api/mesas/{id}

3. OBTENER MESAS POR ESTADO âœ…
   GET /api/mesas/estado/{estado}
   Estados vÃ¡lidos: LIBRE, OCUPADA, RESERVADA

4. CREAR NUEVA MESA âœ…
   POST /api/mesas

5. ACTUALIZAR MESA âœ…
   PUT /api/mesas/{id}

6. ğŸ†• CAMBIAR ESTADO DE MESA âœ…
   PATCH /api/mesas/{id}/estado?estado={estado}
   
   Ejemplo JavaScript:
   const cambiarEstadoMesa = (id, estado) => 
     apiRequest(`/mesas/${id}/estado?estado=${estado}`, {
       method: 'PATCH'
     });

7. ELIMINAR MESA âœ…
   DELETE /api/mesas/{id}

================================================================================
                               CLIENTES âœ…
================================================================================

BASE: /api/clientes

1. OBTENER TODOS LOS CLIENTES âœ…
   GET /api/clientes

2. OBTENER CLIENTE POR ID âœ…
   GET /api/clientes/{id}

3. ğŸ†• BUSCAR CLIENTE POR TELÃ‰FONO âœ…
   GET /api/clientes/telefono/{telefono}
   
   Ejemplo JavaScript:
   const getClienteByTelefono = (telefono) => 
     apiRequest(`/clientes/telefono/${telefono}`);

4. ğŸ†• BUSCAR CLIENTES POR NOMBRE âœ…
   GET /api/clientes/buscar?nombre={nombre}
   
   Ejemplo JavaScript:
   const buscarClientesPorNombre = (nombre) => 
     apiRequest(`/clientes/buscar?nombre=${encodeURIComponent(nombre)}`);

5. CREAR NUEVO CLIENTE âœ…
   POST /api/clientes

6. ACTUALIZAR CLIENTE âœ…
   PUT /api/clientes/{id}

7. ELIMINAR CLIENTE âœ…
   DELETE /api/clientes/{id}

================================================================================
                               EMPLEADOS âœ…
================================================================================

BASE: /api/empleados

1. OBTENER TODOS LOS EMPLEADOS âœ…
   GET /api/empleados

2. OBTENER EMPLEADO POR ID âœ…
   GET /api/empleados/{id}

3. OBTENER EMPLEADOS POR ROL âœ…
   GET /api/empleados/rol/{rol}
   Roles vÃ¡lidos: MESERO, COCINERO, CAJERO, ADMIN

4. CREAR NUEVO EMPLEADO âœ…
   POST /api/empleados

5. ACTUALIZAR EMPLEADO âœ…
   PUT /api/empleados/{id}

6. ELIMINAR EMPLEADO âœ…
   DELETE /api/empleados/{id}

================================================================================
                                PEDIDOS âœ…
================================================================================

BASE: /api/pedidos

1. OBTENER TODOS LOS PEDIDOS âœ…
   GET /api/pedidos

2. OBTENER PEDIDO POR ID âœ…
   GET /api/pedidos/{id}

3. OBTENER PEDIDOS POR ESTADO âœ…
   GET /api/pedidos/estado/{estado}
   Estados vÃ¡lidos: PENDIENTE, EN_PREPARACION, SERVIDO, CANCELADO

4. ğŸ†• OBTENER PEDIDOS POR MESA âœ…
   GET /api/pedidos/mesa/{mesaId}
   
   Ejemplo JavaScript:
   const getPedidosByMesa = (mesaId) => 
     apiRequest(`/pedidos/mesa/${mesaId}`);

5. CREAR NUEVO PEDIDO âœ…
   POST /api/pedidos
   
   Body:
   {
     "mesaId": 1,
     "clienteId": 1,
     "empleadoId": 1
   }

6. ACTUALIZAR PEDIDO âœ…
   PUT /api/pedidos/{id}
   
   Body:
   {
     "estado": "EN_PREPARACION"
   }

7. AGREGAR PRODUCTO AL PEDIDO âœ…
   POST /api/pedidos/{id}/detalles
   
   Body:
   {
     "productoId": 1,
     "cantidad": 2
   }

8. ELIMINAR PEDIDO âœ…
   DELETE /api/pedidos/{id}

================================================================================
                               INVENTARIO âœ…
================================================================================

BASE: /api/inventario

1. OBTENER TODO EL INVENTARIO âœ…
   GET /api/inventario

2. OBTENER INVENTARIO POR ID âœ…
   GET /api/inventario/{id}

3. OBTENER PRODUCTOS CON STOCK BAJO âœ…
   GET /api/inventario/stock-bajo?minimo=5
   
   Ejemplo JavaScript:
   const getStockBajo = (minimo = 5) => 
     apiRequest(`/inventario/stock-bajo?minimo=${minimo}`);

4. ğŸ†• OBTENER INVENTARIO POR PRODUCTO âœ…
   GET /api/inventario/producto/{productoId}
   
   Ejemplo JavaScript:
   const getInventarioByProducto = (productoId) => 
     apiRequest(`/inventario/producto/${productoId}`);

5. CREAR REGISTRO DE INVENTARIO âœ…
   POST /api/inventario
   
   Body:
   {
     "productoId": 1,
     "cantidadStock": 50
   }

6. ACTUALIZAR INVENTARIO âœ…
   PUT /api/inventario/{id}

7. ACTUALIZAR STOCK ESPECÃFICO âœ…
   PUT /api/inventario/producto/{productoId}/stock?cantidad=50

8. ELIMINAR REGISTRO âœ…
   DELETE /api/inventario/{id}

================================================================================
                               FACTURAS âœ…
================================================================================

BASE: /api/facturas

1. OBTENER TODAS LAS FACTURAS âœ…
   GET /api/facturas

2. OBTENER FACTURA POR ID âœ…
   GET /api/facturas/{id}

3. CREAR FACTURA PARA PEDIDO âœ…
   POST /api/facturas/pedido/{pedidoId}/empleado/{empleadoId}

4. OBTENER FACTURAS POR PERÃODO âœ…
   GET /api/facturas/periodo?inicio=2025-05-01T00:00:00&fin=2025-05-31T23:59:59

5. OBTENER TOTAL DE VENTAS âœ…
   GET /api/facturas/ventas-total?inicio=2025-05-01T00:00:00&fin=2025-05-31T23:59:59

6. ğŸ†• OBTENER FACTURAS POR EMPLEADO âœ…
   GET /api/facturas/empleado/{empleadoId}
   
   Ejemplo JavaScript:
   const getFacturasByEmpleado = (empleadoId) => 
     apiRequest(`/facturas/empleado/${empleadoId}`);

7. ğŸ†• ELIMINAR FACTURA âœ…
   DELETE /api/facturas/{id}

================================================================================
                          ğŸ†• MEJORAS IMPLEMENTADAS
================================================================================

âœ… NUEVAS RUTAS AGREGADAS:
- GET /api/productos/buscar?nombre={nombre} - BÃºsqueda de productos
- PATCH /api/mesas/{id}/estado?estado={estado} - Cambio rÃ¡pido de estado
- GET /api/clientes/telefono/{telefono} - BÃºsqueda por telÃ©fono
- GET /api/clientes/buscar?nombre={nombre} - BÃºsqueda de clientes
- GET /api/pedidos/mesa/{mesaId} - Pedidos por mesa
- GET /api/inventario/producto/{productoId} - Inventario por producto
- GET /api/facturas/empleado/{empleadoId} - Facturas por empleado
- DELETE /api/pedidos/{id} - Eliminar pedidos
- DELETE /api/facturas/{id} - Eliminar facturas

âœ… LOGS MEJORADOS:
- Logging detallado en todos los controladores
- InformaciÃ³n de entrada y salida en cada endpoint
- Manejo de errores con contexto especÃ­fico

âœ… VALIDACIONES MEJORADAS:
- ValidaciÃ³n @Valid en todos los endpoints POST/PUT
- Manejo de parÃ¡metros opcionales con valores por defecto
- ValidaciÃ³n de tipos de datos en parÃ¡metros de URL

âœ… CORS MEJORADO:
- ConfiguraciÃ³n completa de CORS en todos los controladores
- Headers expuestos correctamente
- Soporte para todos los mÃ©todos HTTP

âœ… MANEJO DE ERRORES:
- Excepciones capturadas y loggeadas
- Respuestas de error consistentes
- InformaciÃ³n Ãºtil para debugging

================================================================================
                          CÃ“DIGOS DE RESPUESTA HTTP
================================================================================

200 - OK (OperaciÃ³n exitosa)
201 - Created (Recurso creado exitosamente)
204 - No Content (EliminaciÃ³n exitosa)
400 - Bad Request (Datos invÃ¡lidos o faltantes)
404 - Not Found (Recurso no encontrado)
500 - Internal Server Error (Error del servidor)

================================================================================
                            FUNCIONES AUXILIARES PARA FRONTEND
================================================================================

// Formatear fecha para la API
const formatDateForAPI = (date) => {
  return new Date(date).toISOString();
};

// Manejar errores de la API
const handleAPIError = (error) => {
  console.error('API Error:', error);
  // AquÃ­ puedes agregar notificaciones de usuario
  if (error.status === 404) {
    alert('Recurso no encontrado');
  } else if (error.status === 400) {
    alert('Datos invÃ¡lidos');
  } else {
    alert('Error del servidor');
  }
};

// Servicio completo para una entidad (ejemplo: CategorÃ­as)
const categoriaService = {
  getAll: () => apiRequest('/categorias'),
  getById: (id) => apiRequest(`/categorias/${id}`),
  create: (categoria) => apiRequest('/categorias', {
    method: 'POST',
    body: JSON.stringify(categoria)
  }),
  update: (id, categoria) => apiRequest(`/categorias/${id}`, {
    method: 'PUT',
    body: JSON.stringify(categoria)
  }),
  delete: (id) => apiRequest(`/categorias/${id}`, {
    method: 'DELETE'
  })
};

// Ejemplo de uso con async/await
const ejemplo = async () => {
  try {
    // Obtener todas las categorÃ­as
    const categorias = await categoriaService.getAll();
    console.log('CategorÃ­as:', categorias);
    
    // Crear una nueva categorÃ­a
    const nuevaCategoria = await categoriaService.create({
      nombre: 'Nuevos Postres'
    });
    console.log('CategorÃ­a creada:', nuevaCategoria);
    
  } catch (error) {
    handleAPIError(error);
  }
};

// Workflow completo: Crear pedido con productos
const crearPedidoCompleto = async (datosReserva) => {
  try {
    // 1. Crear el pedido
    const pedido = await createPedido({
      mesaId: datosReserva.mesaId,
      clienteId: datosReserva.clienteId,
      empleadoId: datosReserva.empleadoId
    });
    
    // 2. Agregar cada producto al pedido
    for (const producto of datosReserva.productos) {
      await agregarProductoAPedido(pedido.id, {
        productoId: producto.id,
        cantidad: producto.cantidad
      });
    }
    
    // 3. Obtener el pedido completo actualizado
    const pedidoCompleto = await getPedidoById(pedido.id);
    
    return pedidoCompleto;
  } catch (error) {
    handleAPIError(error);
    throw error;
  }
};

================================================================================
                               VALIDACIONES
================================================================================

CAMPOS OBLIGATORIOS:
- Categoria: nombre
- Producto: nombre, precio, categoriaId
- Mesa: numeroMesa
- Empleado: nombre, rol
- Pedido: mesaId
- DetallePedido: productoId, cantidad

FORMATOS ESPECIALES:
- Email: debe tener formato vÃ¡lido
- Precio: debe ser > 0
- Cantidad: debe ser > 0
- Fechas: formato ISO 8601 (YYYY-MM-DDTHH:mm:ss)

RESTRICCIONES DE NEGOCIO:
- No se puede eliminar categorÃ­a con productos
- Mesa no puede tener mÃ¡s de un pedido activo
- Solo pedidos SERVIDOS pueden generar factura
- No se pueden modificar pedidos SERVIDOS o CANCELADOS

================================================================================
                        INFORMACIÃ“N DEL KEEP-ALIVE SYSTEM
================================================================================

El backend incluye un sistema automÃ¡tico de keep-alive que:

âœ… EVITA QUE EL SERVICIO SE DUERMA en Render
âœ… OPTIMIZA RENDIMIENTO en horas de mayor uso
âœ… MANTIENE CONEXIONES ACTIVAS 24/7
âœ… LOGS DETALLADOS del estado del servicio

HORARIOS DE PING:
ğŸ• Cada 10 minutos: Ping bÃ¡sico 24/7
ğŸ•˜ Cada 5 minutos: Horario laboral (8 AM - 10 PM)
ğŸ•œ Cada 3 minutos: Horas pico (12-2 PM y 7-9 PM)
ğŸš€ Cada 30 minutos: Calentamiento del servicio

ENDPOINTS PARA MONITOREO:
- GET / â†’ InformaciÃ³n completa + uptime
- GET /health â†’ Estado detallado del servicio  
- GET /ping â†’ Respuesta rÃ¡pida para verificaciÃ³n

================================================================================
                                   NOTAS
================================================================================

1. âœ… API disponible 24/7 con keep-alive automÃ¡tico
2. âœ… CORS habilitado para todos los orÃ­genes - CORREGIDO
3. âœ… Logs detallados para debugging mejorado
4. âœ… Endpoints de test y verificaciÃ³n
5. âœ… Manejo de errores robusto
6. âœ… Headers CORS expuestos correctamente
7. âœ… CORS issue resuelto - allowCredentials = false
8. âœ… allowedOriginPatterns usado en lugar de allowedOrigins

DEBUGGING MEJORADO:
- ğŸ” Logs especÃ­ficos por endpoint en Render Dashboard
- ğŸŒ Test endpoints individuales con curl o Postman SIN ERRORES CORS
- ğŸ“¡ Console.log detallado en apiRequest para debugging
- ğŸ”„ Verificar keep-alive con GET /ping
- ğŸ“Š Monitoreo de performance por endpoint

CORS TESTING:
- âœ… Postman: Funciona sin errores
- âœ… Browser: No hay errores CORS
- âœ… Frontend: Puede consumir la API sin problemas
- âœ… Keep-alive: Funciona correctamente

================================================================================
                                 FIN DOCUMENTACIÃ“N
================================================================================
